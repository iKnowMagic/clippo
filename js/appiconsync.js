// koffee 1.12.0
var childp, fs, ref, resolve, slash;

ref = require('kxk'), resolve = ref.resolve, childp = ref.childp, slash = ref.slash, childp = ref.childp, fs = ref.fs;

module.exports = function(appName, outDir, size) {
    var absPath, appFolder, conPath, err, i, icnsPath, infoPath, len, obj, pngPath, ref1, splist;
    if (outDir == null) {
        outDir = ".";
    }
    if (size == null) {
        size = 1024;
    }
    if (!appName.endsWith('.app')) {
        appName += ".app";
    }
    ref1 = ["/Applications", "/Applications/Utilities", "/System/Library/CoreServices", "~/Applications"];
    for (i = 0, len = ref1.length; i < len; i++) {
        appFolder = ref1[i];
        absPath = slash.resolve(slash.join(appFolder, appName));
        conPath = slash.join(absPath, 'Contents');
        try {
            infoPath = slash.join(conPath, 'Info.plist');
            fs.accessSync(infoPath, fs.R_OK);
            splist = require('simple-plist');
            obj = splist.readFileSync(infoPath);
            if (obj['CFBundleIconFile'] != null) {
                icnsPath = slash.join(slash.dirname(infoPath), 'Resources', obj['CFBundleIconFile']);
                if (!icnsPath.endsWith('.icns')) {
                    icnsPath += ".icns";
                }
                fs.accessSync(icnsPath, fs.R_OK);
                pngPath = slash.resolve(slash.join(outDir, slash.base(appName) + ".png"));
                childp.execSync("/usr/bin/sips -Z " + size + " -s format png \"" + (slash.escape(icnsPath)) + "\" --out \"" + (slash.escape(pngPath)) + "\"");
                fs.accessSync(pngPath, fs.R_OK);
                return pngPath;
            }
        } catch (error) {
            err = error;
            continue;
        }
    }
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwaWNvbnN5bmMuanMiLCJzb3VyY2VSb290IjoiLi4vY29mZmVlIiwic291cmNlcyI6WyJhcHBpY29uc3luYy5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQU1BLElBQUE7O0FBQUEsTUFBeUMsT0FBQSxDQUFRLEtBQVIsQ0FBekMsRUFBRSxxQkFBRixFQUFXLG1CQUFYLEVBQW1CLGlCQUFuQixFQUEwQixtQkFBMUIsRUFBa0M7O0FBRWxDLE1BQU0sQ0FBQyxPQUFQLEdBQWlCLFNBQUMsT0FBRCxFQUFVLE1BQVYsRUFBc0IsSUFBdEI7QUFFYixRQUFBOztRQUZ1QixTQUFPOzs7UUFBSyxPQUFLOztJQUV4QyxJQUFxQixDQUFJLE9BQU8sQ0FBQyxRQUFSLENBQWlCLE1BQWpCLENBQXpCO1FBQUEsT0FBQSxJQUFXLE9BQVg7O0FBRUE7QUFBQSxTQUFBLHNDQUFBOztRQU1JLE9BQUEsR0FBVSxLQUFLLENBQUMsT0FBTixDQUFjLEtBQUssQ0FBQyxJQUFOLENBQVcsU0FBWCxFQUFzQixPQUF0QixDQUFkO1FBQ1YsT0FBQSxHQUFVLEtBQUssQ0FBQyxJQUFOLENBQVcsT0FBWCxFQUFvQixVQUFwQjtBQUNWO1lBQ0ksUUFBQSxHQUFXLEtBQUssQ0FBQyxJQUFOLENBQVcsT0FBWCxFQUFvQixZQUFwQjtZQUNYLEVBQUUsQ0FBQyxVQUFILENBQWMsUUFBZCxFQUF3QixFQUFFLENBQUMsSUFBM0I7WUFDQSxNQUFBLEdBQVMsT0FBQSxDQUFRLGNBQVI7WUFDVCxHQUFBLEdBQU0sTUFBTSxDQUFDLFlBQVAsQ0FBb0IsUUFBcEI7WUFDTixJQUFHLCtCQUFIO2dCQUNJLFFBQUEsR0FBVyxLQUFLLENBQUMsSUFBTixDQUFXLEtBQUssQ0FBQyxPQUFOLENBQWMsUUFBZCxDQUFYLEVBQW9DLFdBQXBDLEVBQWlELEdBQUksQ0FBQSxrQkFBQSxDQUFyRDtnQkFDWCxJQUF1QixDQUFJLFFBQVEsQ0FBQyxRQUFULENBQWtCLE9BQWxCLENBQTNCO29CQUFBLFFBQUEsSUFBWSxRQUFaOztnQkFDQSxFQUFFLENBQUMsVUFBSCxDQUFjLFFBQWQsRUFBd0IsRUFBRSxDQUFDLElBQTNCO2dCQUNBLE9BQUEsR0FBVSxLQUFLLENBQUMsT0FBTixDQUFjLEtBQUssQ0FBQyxJQUFOLENBQVcsTUFBWCxFQUFtQixLQUFLLENBQUMsSUFBTixDQUFXLE9BQVgsQ0FBQSxHQUFzQixNQUF6QyxDQUFkO2dCQUNWLE1BQU0sQ0FBQyxRQUFQLENBQWdCLG1CQUFBLEdBQW9CLElBQXBCLEdBQXlCLG1CQUF6QixHQUEyQyxDQUFDLEtBQUssQ0FBQyxNQUFOLENBQWEsUUFBYixDQUFELENBQTNDLEdBQWtFLGFBQWxFLEdBQThFLENBQUMsS0FBSyxDQUFDLE1BQU4sQ0FBYSxPQUFiLENBQUQsQ0FBOUUsR0FBb0csSUFBcEg7Z0JBQ0EsRUFBRSxDQUFDLFVBQUgsQ0FBYyxPQUFkLEVBQXVCLEVBQUUsQ0FBQyxJQUExQjtBQUNBLHVCQUFPLFFBUFg7YUFMSjtTQUFBLGFBQUE7WUFhTTtBQUNGLHFCQWRKOztBQVJKO0FBSmEiLCJzb3VyY2VzQ29udGVudCI6WyIjIDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDBcbiMwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMDAgIDAwMCAgMDAwICAgICAgICAwMDAgMDAwICAgMDAwMCAgMDAwICAwMDAgICAgIFxuIzAwMDAwMDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwICAwMDAwMDAwICAgICAwMDAwMCAgICAwMDAgMCAwMDAgIDAwMCAgICAgXG4jMDAwICAgMDAwICAwMDAgICAgICAgIDAwMCAgICAgICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgIDAwMDAgICAgICAgMDAwICAgICAwMDAgICAgIDAwMCAgMDAwMCAgMDAwICAgICBcbiMwMDAgICAwMDAgIDAwMCAgICAgICAgMDAwICAgICAgICAwMDAgICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgICAgIDAwMCAgICAgMDAwICAgMDAwICAgMDAwMDAwMFxuXG57IHJlc29sdmUsIGNoaWxkcCwgc2xhc2gsIGNoaWxkcCwgZnMgfSA9IHJlcXVpcmUgJ2t4aycgXG5cbm1vZHVsZS5leHBvcnRzID0gKGFwcE5hbWUsIG91dERpcj1cIi5cIiwgc2l6ZT0xMDI0KSAtPlxuXG4gICAgYXBwTmFtZSArPSBcIi5hcHBcIiBpZiBub3QgYXBwTmFtZS5lbmRzV2l0aCAnLmFwcCdcblxuICAgIGZvciBhcHBGb2xkZXIgaW4gW1xuICAgICAgICAgICAgXCIvQXBwbGljYXRpb25zXCJcbiAgICAgICAgICAgIFwiL0FwcGxpY2F0aW9ucy9VdGlsaXRpZXNcIlxuICAgICAgICAgICAgXCIvU3lzdGVtL0xpYnJhcnkvQ29yZVNlcnZpY2VzXCJcbiAgICAgICAgICAgIFwifi9BcHBsaWNhdGlvbnNcIlxuICAgICAgICBdXG4gICAgICAgIGFic1BhdGggPSBzbGFzaC5yZXNvbHZlIHNsYXNoLmpvaW4gYXBwRm9sZGVyLCBhcHBOYW1lXG4gICAgICAgIGNvblBhdGggPSBzbGFzaC5qb2luIGFic1BhdGgsICdDb250ZW50cydcbiAgICAgICAgdHJ5XG4gICAgICAgICAgICBpbmZvUGF0aCA9IHNsYXNoLmpvaW4gY29uUGF0aCwgJ0luZm8ucGxpc3QnXG4gICAgICAgICAgICBmcy5hY2Nlc3NTeW5jIGluZm9QYXRoLCBmcy5SX09LXG4gICAgICAgICAgICBzcGxpc3QgPSByZXF1aXJlICdzaW1wbGUtcGxpc3QnXG4gICAgICAgICAgICBvYmogPSBzcGxpc3QucmVhZEZpbGVTeW5jIGluZm9QYXRoICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiBvYmpbJ0NGQnVuZGxlSWNvbkZpbGUnXT9cbiAgICAgICAgICAgICAgICBpY25zUGF0aCA9IHNsYXNoLmpvaW4gc2xhc2guZGlybmFtZShpbmZvUGF0aCksICdSZXNvdXJjZXMnLCBvYmpbJ0NGQnVuZGxlSWNvbkZpbGUnXVxuICAgICAgICAgICAgICAgIGljbnNQYXRoICs9IFwiLmljbnNcIiBpZiBub3QgaWNuc1BhdGguZW5kc1dpdGggJy5pY25zJ1xuICAgICAgICAgICAgICAgIGZzLmFjY2Vzc1N5bmMgaWNuc1BhdGgsIGZzLlJfT0sgXG4gICAgICAgICAgICAgICAgcG5nUGF0aCA9IHNsYXNoLnJlc29sdmUgc2xhc2guam9pbiBvdXREaXIsIHNsYXNoLmJhc2UoYXBwTmFtZSkgKyBcIi5wbmdcIlxuICAgICAgICAgICAgICAgIGNoaWxkcC5leGVjU3luYyBcIi91c3IvYmluL3NpcHMgLVogI3tzaXplfSAtcyBmb3JtYXQgcG5nIFxcXCIje3NsYXNoLmVzY2FwZSBpY25zUGF0aH1cXFwiIC0tb3V0IFxcXCIje3NsYXNoLmVzY2FwZSBwbmdQYXRofVxcXCJcIlxuICAgICAgICAgICAgICAgIGZzLmFjY2Vzc1N5bmMgcG5nUGF0aCwgZnMuUl9PS1xuICAgICAgICAgICAgICAgIHJldHVybiBwbmdQYXRoXG4gICAgICAgIGNhdGNoIGVyclxuICAgICAgICAgICAgY29udGludWVcbiJdfQ==
//# sourceURL=../coffee/appiconsync.coffee